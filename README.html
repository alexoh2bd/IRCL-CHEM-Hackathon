<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>readme</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="README_files/libs/clipboard/clipboard.min.js"></script>
<script src="README_files/libs/quarto-html/quarto.js"></script>
<script src="README_files/libs/quarto-html/popper.min.js"></script>
<script src="README_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="README_files/libs/quarto-html/anchor.min.js"></script>
<link href="README_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="README_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="README_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="README_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="README_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="chemlit-qa-instruction-following-retrieval-dataset" class="level1">
<h1>ChemLit-QA Instruction-Following Retrieval Dataset</h1>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This project creates an instruction-following retrieval dataset for chemistry domain using the ChemLit-QA dataset as a foundation. Inspired by the <strong>Promptriever</strong> methodology, we generate instruction-positive and instruction-negative passage pairs to train retrieval models that can follow nuanced relevance criteria beyond simple query matching.</p>
</section>
<section id="dataset-link" class="level2">
<h2 class="anchored" data-anchor-id="dataset-link"><a href="https://drive.google.com/drive/folders/1StPzvw1RTF0DwVVkq9_rDkejmFQHyQ7x?usp=sharing">Dataset Link</a></h2>
</section>
<section id="motivation-reasoning" class="level2">
<h2 class="anchored" data-anchor-id="motivation-reasoning">Motivation &amp; Reasoning</h2>
<section id="the-problem" class="level3">
<h3 class="anchored" data-anchor-id="the-problem">The Problem</h3>
<p>Traditional retrieval systems operate on basic query-document similarity, but real-world information needs often require more nuanced relevance criteria. For example, a chemistry researcher might need passages that not only discuss “polymer crystallization” but specifically include “temperature ranges and kinetic parameters.”</p>
</section>
<section id="our-approach" class="level3">
<h3 class="anchored" data-anchor-id="our-approach">Our Approach</h3>
<p>Following the Promptriever framework, we: 1. <strong>Generate Instructions</strong>: Create natural language instructions that narrow relevance definitions 2. <strong>Generate Passage Candidates</strong>: Produce both instruction-positive and instruction-negative examples 3. <strong>Create Training Data</strong>: Build high-quality instruction-following retrieval datasets</p>
</section>
</section>
<section id="dataset-information" class="level2">
<h2 class="anchored" data-anchor-id="dataset-information">Dataset Information</h2>
<p><strong>Base Dataset</strong>: <a href="https://github.com/geemi725/ChemLit-QA">ChemLit-QA</a> - 1,000+ expert-validated chemistry Q&amp;A pairs - Covers diverse chemistry topics with rigorous expert evaluation - Provides rich context for generating nuanced instructions</p>
<p><strong>Generated Dataset Structure</strong>:</p>
<pre><code>ChemLit-QA ID:
Query
Original Positive
Instruction
Response
 - Response Id
 - Label: Positive or Negative
 - Response Passage: (Generated based on the Query + Instruction Pair)
 - Confidence Score (Generated by the Model)</code></pre>
</section>
<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology">Methodology</h2>
<section id="step-1-instruction-generation" class="level3">
<h3 class="anchored" data-anchor-id="step-1-instruction-generation">Step 1: Instruction Generation</h3>
<p>Using <code>text.yaml</code> template with Cerebras Qwen-3-32B model: - <strong>Input</strong>: Chemistry question + answer pair - <strong>Output</strong>: Natural language instruction that adds qualifications - <strong>Styles</strong>: Persona, negation, background, generic - <strong>Lengths</strong>: Short, medium, long, very long</p>
</section>
<section id="step-2-passage-generation" class="level3">
<h3 class="anchored" data-anchor-id="step-2-passage-generation">Step 2: Passage Generation</h3>
<p>Using <code>responses.yaml</code> template: - Generate 1 instruction-positive passage - Generate 5-6 instruction-negative passages - Each negative follows specific failure modes: - Omission of required details - Different interpretation - Mentions excluded elements - Partial answers - Outdated information - Unsupported inference</p>
</section>
<section id="step-3-quality-filtering" class="level3">
<h3 class="anchored" data-anchor-id="step-3-quality-filtering">Step 3: Quality Filtering</h3>
<p>I intended to use FollowIR-7B model for validation: - <strong>Instruction Positives</strong>: Must be relevant to both query AND instruction - <strong>Instruction Negatives</strong>: Must be relevant to query but NOT to instruction - Confidence scoring for each relevance decision - Memory-efficient batch processing with checkpointing</p>
</section>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<p>Example 1:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Original Query</span><span class="kw">:</span><span class="at"> What happens to the separation of compounds when the pressure is increased?</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Original Response</span><span class="kw">:</span><span class="at"> Some compounds separate better at higher pressure</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Generated Instruction</span><span class="kw">:</span><span class="at"> A relevant passage must describe how increased pressure chemically or physically influences the separation of compounds, specifically addressing the type of compounds involved (e.g., volatile, polar, or gas-phase species) and the separation mechanism (e.g., distillation, gas solubility, or chromatography). General statements about pressure effects without tying them to molecular interactions, phase behavior, or method-specific adjustments are not sufficient for relevance.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">I-Positive Response</span><span class="kw">:</span><span class="at"> Increasing pressure affects compound separation differently depending on the method. In distillation, higher pressure raises boiling points for volatile compounds, making their separation less efficient due to reduced vapor-liquid equilibrium differences. For gas-phase compounds in gas chromatography, elevated column inlet pressure accelerates flow rates, shortening retention times and decreasing separation efficiency, while reducing outlet pressure improves resolution for non-polar compounds by prolonging interaction with the stationary phase. Polar compounds in liquid chromatography exhibit altered solubility at higher pressures, impacting partitioning between phases. Additionally, gas solubility in liquids increases with pressure (Henry’s Law), which complicates methods like pressure-sensitive extraction. Source chunks ID1-3 support these specific compound-type and mechanism-dependent effects.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">I-Negative Response 1</span><span class="kw">:</span><span class="at"> Pressure influences chemical equilibria by favoring low-molar-volume reactions. In high-pressure environments, compounds often resist phase changes. This can stabilize reaction intermediates but may also hinder equilibration.</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">I-Negative Response 2</span><span class="kw">:</span><span class="at"> Elevated pressure reduces the volatility of compounds, narrowing boiling point differences. In vacuum distillations, lower pressure increases separation efficiency for volatile mixtures by lowering their boiling points.</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">Example 2</span><span class="kw">:</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="at">```yaml</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">Original Query</span><span class="kw">:</span><span class="at"> Why was UV-ozone treatment used instead of the harsher piranha treatment for treating glass substrates?</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">Original Response</span><span class="kw">:</span><span class="at"> UV-ozone treatment was used instead of the harsher piranha treatment because it allowed pre-determining the film growth area by covering the undesired areas with acrylic tape, whereas the piranha treatment tends to etch away the ITO.</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">Generated Instruction</span><span class="kw">:</span><span class="at"> A relevant passage must explain the use of a surface treatment method that allows controlled application of film growth by utilizing masking techniques, and must highlight the importance of preserving functional materials on the substrate. Passages that only mention alternative treatments without addressing their specific impacts on substrate integrity or masking compatibility are not relevant. Additionally, exclude any responses that provide general descriptions of either method without focusing on the comparative advantages related to material protection and film area definition.</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">I-Positive Response</span><span class="kw">:</span><span class="at"> UV-ozone treatment was selected for glass substrates due to its compatibility with photolithography masking techniques and its ability to preserve functional materials during surface preparation. Unlike piranha etch, which employs a mixture of sulfuric acid and hydrogen peroxide at elevated temperatures, UV-ozone relies on reactive oxygen species generated by UV light to oxidize the glass surface. This method avoids contact with corrosive chemicals, preventing degradation of sensitive films like organic passivations or photoresists. Studies in C1 demonstrate that UV-ozone preserves native surface charge distributions critical for semiconductor patterning, whereas piranha etching (C2) often introduces microcracks and alters surface topography irreversibly. By selectively oxidizing exposed areas without requiring physical masking layers, UV-ozone enables accurate definition of film growth regions while maintaining substrate material integrity, as validated by C3's comparative analysis.</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">I-Negative Response 1</span><span class="kw">:</span><span class="at"> UV-ozone was used for glass substrates because it minimizes liquid chemical exposure compared to piranha etch. While piranha etching involves hazardous sulfuric acid and strong oxidizers, UV-ozone utilizes gaseous ozone and UV radiation, reducing chemical waste and operator risk. However, it does not specify how each method affects substrate material stability or compatibility with masking processes, nor does it address functional material preservation as required.</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">I-Negative Response 2</span><span class="kw">:</span><span class="at"> The choice of UV-ozone treatment over piranha etching was primarily motivated by operational cost savings. UV systems require no disposable chemicals and offer faster processing times, as demonstrated in C4. Although C5 notes that both methods achieve surface hydrophilicity, the focus on economical advantages shifts from the instruction’s emphasis on masking compatibility and material integrity preservation during film patterning.</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">## Configuration</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="at">```python</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Ingestion Settings</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="at">BATCH_SIZE = 20</span><span class="co">              # Rows to write at once</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="at">CHECKPOINT_INTERVAL = 5</span><span class="co">      # Save state every N rows</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="at">MAX_ROWS = None</span><span class="co">             # Limit processing (None = all)</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Model Settings</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="at">MODEL = "qwen-3-32b"</span><span class="co">        # Instruction generation model</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="at">FILTER_MODEL = "jhu-clsp/FollowIR-7B"</span><span class="co">  # Relevance filtering model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="results-outcomes" class="level2">
<h2 class="anchored" data-anchor-id="results-outcomes">Results &amp; Outcomes</h2>
<section id="dataset-statistics" class="level3">
<h3 class="anchored" data-anchor-id="dataset-statistics">Dataset Statistics</h3>
<ul>
<li><p><strong>Source</strong>: 1,000+ ChemLit-QA entries</p></li>
<li><p><strong>Generated</strong>: ~6,000+ instruction-passage pairs</p></li>
<li><p><strong>Coverage</strong>: Diverse chemistry domains with expert-validated foundations</p></li>
</ul>
</section>
<section id="quality-metrics" class="level3">
<h3 class="anchored" data-anchor-id="quality-metrics">Quality Metrics</h3>
<ul>
<li><strong>Instruction Diversity</strong>: 4 styles × 4 lengths = 16 instruction variants</li>
<li><strong>Failure Mode Coverage</strong>: 6 distinct negative passage types</li>
</ul>
<section id="instruction-positive-prompt-response-pairs" class="level5">
<h5 class="anchored" data-anchor-id="instruction-positive-prompt-response-pairs">INSTRUCTION POSITIVE Prompt-Response Pairs</h5>
<ul>
<li><strong>Count</strong>: 867 (17.2% of total)</li>
<li><strong>Mean</strong>: 0.9553</li>
<li><strong>Median</strong>: 0.9500</li>
<li><strong>Std Dev</strong>: 0.0259</li>
<li><strong>Variance</strong>: 0.0007</li>
<li><strong>Range</strong>: 0.8000 - 1.0000</li>
<li><strong>IQR</strong>: 0.9500 - 0.9800</li>
<li><strong>Skewness</strong>: -1.0970</li>
<li><strong>Kurtosis</strong>: 3.5059</li>
</ul>
</section>
<section id="instruction-negatiive-prompt-response-pairs" class="level5">
<h5 class="anchored" data-anchor-id="instruction-negatiive-prompt-response-pairs">INSTRUCTION NEGATIIVE Prompt-Response Pairs</h5>
<ul>
<li><strong>Count</strong>: 4174 (82.7% of total)</li>
<li><strong>Mean</strong>: 0.5290</li>
<li><strong>Median</strong>: 0.5700</li>
<li><strong>Std Dev</strong>: 0.1829</li>
<li><strong>Variance</strong>: 0.0334</li>
<li><strong>Range</strong>: 0.0000 - 1.0000</li>
<li><strong>IQR</strong>: 0.4000 - 0.6800</li>
<li><strong>Skewness</strong>: -0.3999</li>
<li><strong>Kurtosis</strong>: -0.7277</li>
</ul>
</section>
</section>
<section id="key-innovations" class="level3">
<h3 class="anchored" data-anchor-id="key-innovations">Key Innovations</h3>
<ol type="1">
<li><strong>Chemistry-Specific Instructions</strong>: Domain-aware relevance criteria</li>
<li><strong>Automated Quality Control</strong>: Model-based filtering pipeline</li>
<li><strong>Scalable Architecture</strong>: Memory-efficient processing for large datasets</li>
<li><strong>Comprehensive Validation</strong>: Multi-stage quality assurance</li>
</ol>
</section>
<section id="pitfalls-and-improvements" class="level3">
<h3 class="anchored" data-anchor-id="pitfalls-and-improvements">Pitfalls and Improvements</h3>
<ol type="1">
<li><strong>Inconsistent LM Responses and Data Loss</strong>: Inconsistent response formatting led to loss of responses and pipeline issues. <span class="math inline">\(903 / 1025\)</span> entries logged.</li>
<li><strong>Incomplete Implementation of the Promptriever Data Generation Workflow</strong>: Intended to use the instruction retrieval encoder FollowIR to assess the relevance of prompt response pairs and filter and filter positive and negative responses out of range.</li>
</ol>
</section>
</section>
<section id="usage" class="level2">
<h2 class="anchored" data-anchor-id="usage">Usage</h2>
<section id="generate-dataset" class="level3">
<h3 class="anchored" data-anchor-id="generate-dataset">Generate Dataset</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run instruction-following dataset generation</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> src/data/ingestion_v2.py</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter generated passages</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> src/data/filterv2.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="future-work" class="level2">
<h2 class="anchored" data-anchor-id="future-work">Future Work</h2>
<ol type="1">
<li><strong>Evaluation Framework</strong>: Implement retrieval performance benchmarks</li>
<li><strong>Model Training</strong>: Fine-tune retrieval models on generated dataset</li>
<li><strong>Domain Expansion</strong>: Extend methodology to other scientific domains</li>
<li><strong>Interactive Filtering</strong>: Human-in-the-loop quality validation</li>
</ol>
</section>
<section id="citation" class="level2">
<h2 class="anchored" data-anchor-id="citation">Citation</h2>
<p>This work builds upon: - <strong>ChemLit-QA</strong>: Expert-validated chemistry Q&amp;A dataset - <strong>Promptriever</strong>: Instruction-following retrieval methodology - <strong>FollowIR</strong>: Instruction-aware relevance modeling</p>
<hr>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>